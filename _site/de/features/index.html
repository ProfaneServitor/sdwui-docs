<!DOCTYPE HTML>
<html lang="en" >
    <head><meta charset="UTF-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"><title>Features · Stable Diffusion webUI</title><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="description" content="A browser interface based on Gradio library for Stable Diffusion.
"><meta name="generator" content="Jekyll (using style of GitBook 3.2.3)"><link rel="stylesheet" href="/sdwui-docs/de/assets/gitbook/style.css">
<link rel="stylesheet" href="/sdwui-docs/de/assets/gitbook/gitbook-plugin-fontsettings/website.css">
<link rel="stylesheet" href="/sdwui-docs/de/assets/gitbook/gitbook-plugin-search-pro/search.css">
<link rel="stylesheet" href="/sdwui-docs/de/assets/gitbook/gitbook-plugin-back-to-top-button/plugin.css">

<link rel="stylesheet" href="/sdwui-docs/de/assets/gitbook/rouge/colorful.css">

<link rel="stylesheet" href="/sdwui-docs/de/assets/gitbook/custom.css">

<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/sdwui-docs/de/assets/gitbook/images/apple-touch-icon-precomposed-152.png">
<link rel="shortcut icon" href="/sdwui-docs/de//assets/gitbook/images/favicon.ico" type="image/x-icon">




            <link rel="prev" href="/sdwui-docs/extensions/" />
        

        
            <link rel="next" href="/sdwui-docs/de/install-on-amd/" />
        
    </head>
    <body>
        <div class="book">
<div class="book-summary">
    <nav role="navigation">
        <div id="lang">
<a href="/sdwui-docs/features/"><img class="emoji" title=":uk:" alt=":uk:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1e7.png" height="20" width="20"> en</a> | <a href="/sdwui-docs/ru/features/"><img class="emoji" title=":ru:" alt=":ru:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1f7-1f1fa.png" height="20" width="20"> ru</a> | <a style="font-weight: bold;" href="/sdwui-docs/de/features/"><img class="emoji" title=":de:" alt=":de:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1e9-1f1ea.png" height="20" width="20"> de</a> | <br>
</div>
        <div id="book-search-input" role="search">
            <input type="text" placeholder="Type to search">
        </div>
        <div id="book-search-input-link" role="search">
            <a href="/sdwui-docs/de/assets/search.html">Click to Search</a>
        </div>
        <ul class="summary">
            
            <li class="chapter" data-level="1.1" data-path="/sdwui-docs">
            
                <!-- <a href="/sdwui-docs/de/">
                    Stable Diffusion webUI
                </a> -->
            </li>

            <!-- <li class="divider"></li> -->


                    
                    
                    <li>
                      <h2>Guides</h2>
                      </li>
                      
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/cli/">
                          
                              <a href="/sdwui-docs/de/cli/">
                                  Command line arguments and settings
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/custom-filenames/">
                          
                              <a href="/sdwui-docs/de/custom-filenames/">
                                  Custom images filename and subdirectory
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/custom-scripts/">
                          
                              <a href="/sdwui-docs/de/custom-scripts/">
                                  Custom scripts
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/developing-custom-scripts/">
                          
                              <a href="/sdwui-docs/developing-custom-scripts/">
                                  Developing custom scripts
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/extensions/">
                          
                              <a href="/sdwui-docs/extensions/">
                                  Extensions
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter active" data-level="1.2" data-path="/sdwui-docs/features/">
                          
                              <a href="/sdwui-docs/de/features/">
                                  Features
                              </a>
                              
                                  
                                      <ul>
<li>
<a href="#stable-diffusion-20">Stable Diffusion 2.0</a><ul>
<li><a href="#basic-models">Basic models</a></li>
<li><a href="#depth-guided-model">Depth-guided model</a></li>
</ul>
</li>
<li><a href="#outpainting">Outpainting</a></li>
<li>
<a href="#inpainting">Inpainting</a><ul>
<li><a href="#inpainting-model">Inpainting model</a></li>
<li><a href="#masked-content">Masked content</a></li>
<li><a href="#inpaint-at-full-resolution">Inpaint at full resolution</a></li>
<li><a href="#masking-mode">Masking mode</a></li>
<li><a href="#alpha-mask">Alpha mask</a></li>
</ul>
</li>
<li><a href="#prompt-matrix">Prompt matrix</a></li>
<li><a href="#color-sketch">Color Sketch</a></li>
<li><a href="#stable-diffusion-upscale">Stable Diffusion upscale</a></li>
<li><a href="#attentionemphasis">Attention/emphasis</a></li>
<li><a href="#loopback">Loopback</a></li>
<li>
<a href="#xy-plot">X/Y plot</a><ul><li><a href="#prompt-sr">Prompt S/R</a></li></ul>
</li>
</ul>
</li>
<li><a href="#textual-inversion">Textual Inversion</a></li>
<li><a href="#resizing">Resizing</a></li>
<li><a href="#sampling-method-selection">Sampling method selection</a></li>
<li><a href="#seed-resize">Seed resize</a></li>
<li><a href="#variations">Variations</a></li>
<li><a href="#styles">Styles</a></li>
<li><a href="#negative-prompt">Negative prompt</a></li>
<li><a href="#clip-interrogator">CLIP interrogator</a></li>
<li>
<a href="#prompt-editing">Prompt editing</a><ul><li><a href="#alternating-words">Alternating Words</a></li></ul>
</li>
<li><a href="#highres-fix">Highres. fix</a></li>
<li><a href="#composable-diffusion">Composable Diffusion</a></li>
<li><a href="#interrupt">Interrupt</a></li>
<li><a href="#4gb-videocard-support">4GB videocard support</a></li>
<li><a href="#face-restoration">Face restoration</a></li>
<li><a href="#saving">Saving</a></li>
<li><a href="#loading">Loading</a></li>
<li><a href="#prompt-validation">Prompt validation</a></li>
<li><a href="#png-info">Png info</a></li>
<li><a href="#settings">Settings</a></li>
<li><a href="#filenames-format">Filenames format</a></li>
<li><a href="#user-scripts">User scripts</a></li>
<li><a href="#ui-config">UI config</a></li>
<li><a href="#esrgan">ESRGAN</a></li>
<li><a href="#img2img-alternative-test">img2img alternative test</a></li>
<li><a href="#usercss">user.css</a></li>
<li><a href="#notificationmp3">notification.mp3</a></li>
<li>
<a href="#tweaks">Tweaks</a><ul><li><a href="#ignore-last-layers-of-clip-model">Ignore last layers of CLIP model</a></li></ul>
</li>
</ul>

                                  
                              
                          
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/list-of-time-zones/">
                          
                              <a href="/sdwui-docs/de/list-of-time-zones/">
                                  List of time zones
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/localization/">
                          
                              <a href="/sdwui-docs/de/localization/">
                                  Localization
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/negative-prompt/">
                          
                              <a href="/sdwui-docs/negative-prompt/">
                                  Negative prompt
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/optimizations/">
                          
                              <a href="/sdwui-docs/optimizations/">
                                  Optimizations
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/textual-inversion/">
                          
                              <a href="/sdwui-docs/de/textual-inversion/">
                                  Textual inversion
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/troubleshooting/">
                          
                              <a href="/sdwui-docs/de/troubleshooting/">
                                  Troubleshooting
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/xformers/">
                          
                              <a href="/sdwui-docs/de/xformers/">
                                  Xformers
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/api/">
                          
                              <a href="/sdwui-docs/de/api/">
                                  API guide
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/pages/ru/Optimizations/">
                          
                              <a href="/sdwui-docs/de/pages/ru/Optimizations/">
                                  Оптимизации
                              </a>
                              
                                  
                              
                          </li>
                      
                      <li class="divider">
                    
                    </li>
<li>
                      <h2>development</h2>
                      </li>
                      
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/contributing/">
                          
                              <a href="/sdwui-docs/de/contributing/">
                                  Contributing
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/developing-extensions/">
                          
                              <a href="/sdwui-docs/developing-extensions/">
                                  Developing extensions
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/pages/en/Tests/">
                          
                              <a href="/sdwui-docs/de/pages/en/Tests/">
                                  Tests
                              </a>
                              
                                  
                              
                          </li>
                      
                      <li class="divider">
                    
                    </li>
<li>
                      <h2>Getting started</h2>
                      </li>
                      
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/dependencies/">
                          
                              <a href="/sdwui-docs/dependencies/">
                                  dependencies
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/install-on-amd/">
                          
                              <a href="/sdwui-docs/de/install-on-amd/">
                                  install on AMD
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/install-on-nvidia/">
                          
                              <a href="/sdwui-docs/de/install-on-nvidia/">
                                  install on Nvidia
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/install-on-apple/">
                          
                              <a href="/sdwui-docs/de/install-on-apple/">
                                  install on Apple
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/">
                          
                              <a href="/sdwui-docs/de/">
                                  Stable Diffusion webUI
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/install/">
                          
                              <a href="/sdwui-docs/de/install/">
                                  Install
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/online-services/">
                          
                              <a href="/sdwui-docs/online-services/">
                                  Online services
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/ui-defaults/">
                          
                              <a href="/sdwui-docs/de/ui-defaults/">
                                  Changing UI defaults
                              </a>
                              
                                  
                              
                          </li>
                      
                      <li class="divider">
                    

                    

            <!-- <li>
                <a href="https://github.com/sighingnow/jekyll-gitbook/fork" target="blank" class="gitbook-link">
                    Fork it Now!
                </a>
            </li> -->
            </li>
<li><h2>Release notes</h2></li>
            
              <li>
                <a href="/sdwui-docs/de/2022/12/27/my-new-post/">
                  Release note example
                </a>
              </li>
            
        
    </nav>
</div>
<div class="book-body">
                <div class="book-header" role="navigation">
                    <!-- Title -->
                    <h1>
                        <i class="fa fa-circle-o-notch fa-spin"></i>
                        
                            <a href=".">Features</a>
                        
                    </h1>
                </div>

                <div class="body-inner">
<div class="page-wrapper" tabindex="-1" role="main">
    

    <div class="page-inner">
        <div id="book-search-results">
            <div class="search-noresults">
                <section class="normal markdown-section">
                    
                        <h1 id="/Features">Features</h1>
                    

                    
                    <p>This is a feature showcase page for <a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui">Stable Diffusion web UI</a>.</p>

<p>All examples are non-cherrypicked unless specified otherwise.</p>

<h1 id="stable-diffusion-20">Stable Diffusion 2.0</h1>
<h2 id="basic-models">Basic models</h2>
<p>Models are supported: 768-v-ema.ckpt (<a href="https://huggingface.co/stabilityai/stable-diffusion-2/blob/main/768-v-ema.ckpt">model</a>, <a href="https://raw.githubusercontent.com/Stability-AI/stablediffusion/main/configs/stable-diffusion/v2-inference-v.yaml">config</a>) and 512-base-ema.ckpt (<a href="https://huggingface.co/stabilityai/stable-diffusion-2-base/blob/main/512-base-ema.ckpt">model</a>, <a href="https://raw.githubusercontent.com/Stability-AI/stablediffusion/main/configs/stable-diffusion/v2-inference.yaml">config</a>). 2.1 checkpoints should also work.</p>

<ul>
  <li>download the checkpoint (from here: https://huggingface.co/stabilityai/stable-diffusion-2)</li>
  <li>put it into models/Stable-Diffusion directory</li>
  <li>grab the config from SD2.0 repository and put it into same place as the checkpoint, renaming it to have same filename (i.e. if your checkpoint is named <code class="language-plaintext highlighter-rouge">768-v-ema.ckpt</code>, the config should be named <code class="language-plaintext highlighter-rouge">768-v-ema.yaml</code>)</li>
  <li>select the new checkpoint from the UI</li>
</ul>

<p>Train tab will most likely be broken for the 2.0 models.</p>

<p>If 2.0 or 2.1 is generating black images, enable full precision with <code class="language-plaintext highlighter-rouge">--no-half</code> or try using the <code class="language-plaintext highlighter-rouge">--xformers</code> optimization.</p>

<p><em><strong>Note:</strong></em> SD 2.0 and 2.1 are more sensitive to FP16 numerical instability (as noted by themselves <a href="https://github.com/Stability-AI/stablediffusion/commit/c12d960d1ee4f9134c2516862ef991ec52d3f59e">here</a>) due to their new cross attention module.</p>

<p>On fp16: <a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui/issues/5503#issuecomment-1341495770">comment</a> to enable, in webui-user.bat:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo off

set PYTHON=
set GIT=
set VENV_DIR=
set COMMANDLINE_ARGS=your command line options
set STABLE_DIFFUSION_COMMIT_HASH="c12d960d1ee4f9134c2516862ef991ec52d3f59e"
set ATTN_PRECISION=fp16

call webui.bat
</code></pre></div></div>

<h2 id="depth-guided-model">Depth-guided model</h2>
<p><a href="https://github.com/Stability-AI/stablediffusion#depth-conditional-stable-diffusion">More info</a>. <a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui/pull/5542">PR</a>.
Instructions:</p>
<ul>
  <li>download the <a href="https://huggingface.co/stabilityai/stable-diffusion-2-depth">512-depth-ema.ckpt</a> checkpoint</li>
  <li>place it in models/Stable-diffusion</li>
  <li>grab the <a href="https://raw.githubusercontent.com/Stability-AI/stablediffusion/main/configs/stable-diffusion/v2-midas-inference.yaml">config</a> and place it in the same folder as the checkpoint</li>
  <li>rename the config to <code class="language-plaintext highlighter-rouge">512-depth-ema.yaml</code>
</li>
  <li>select the new checkpoint from the UI</li>
</ul>

<p>The depth-guided model will only work in img2img tab.</p>

<h1 id="outpainting">Outpainting</h1>

<p>Outpainting extends the original image and inpaints the created empty space.</p>

<p>Example:</p>

<table>
  <thead>
    <tr>
      <th>Original</th>
      <th>Outpainting</th>
      <th>Outpainting again</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="images/outpainting-1.png" alt=""></td>
      <td><img src="images/outpainting-2.png" alt=""></td>
      <td><img src="images/outpainting-3.png" alt=""></td>
    </tr>
  </tbody>
</table>

<p>Original image by Anonymous user from 4chan. Thank you, Anonymous user.</p>

<p>You can find the feature in the img2img tab at the bottom, under Script -&gt; Poor man’s outpainting.</p>

<p>Outpainting, unlike normal image generation, seems to profit very much from large step count. A recipe for a good outpainting
is a good prompt that matches the picture, sliders for denoising and CFG scale set to max, and step count of 50 to 100 with
Euler ancestral or DPM2 ancestral samplers.</p>

<table>
  <thead>
    <tr>
      <th>81 steps, Euler A</th>
      <th>30 steps, Euler A</th>
      <th>10 steps, Euler A</th>
      <th>80 steps, Euler A</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="images/inpainting-81-euler-a.png" alt=""></td>
      <td><img src="images/inpainting-30-euler-a.png" alt=""></td>
      <td><img src="images/inpainting-10-euler-a.png" alt=""></td>
      <td><img src="images/inpainting-80-dpm2-a.png" alt=""></td>
    </tr>
  </tbody>
</table>

<h1 id="inpainting">Inpainting</h1>
<p>In img2img tab, draw a mask over a part of the image, and that part will be in-painted.</p>

<p><img src="images/inpainting.png" alt=""></p>

<p>Options for inpainting:</p>
<ul>
  <li>draw a mask yourself in the web editor</li>
  <li>erase a part of the picture in an external editor and upload a transparent picture. Any even slightly transparent areas will become part of the mask. Be aware that <a href="https://docs.krita.org/en/reference_manual/layers_and_masks/split_alpha.html#how-to-save-a-png-texture-and-keep-color-values-in-fully-transparent-areas">some editors</a> save completely transparent areas as black by default.</li>
  <li>change mode (to the bottom right of the picture) to “Upload mask” and choose a separate black and white image for the mask (white=inpaint).</li>
</ul>

<h2 id="inpainting-model">Inpainting model</h2>
<p>RunwayML has trained an additional model specifically designed for inpainting. This model accepts additional inputs - the initial image without noise plus the mask - and seems to be much better at the job.</p>

<p>Download and extra info for the model is here: https://github.com/runwayml/stable-diffusion#inpainting-with-stable-diffusion</p>

<p>To use the model, you must rename the checkpoint so that its filename ends in <code class="language-plaintext highlighter-rouge">inpainting.ckpt</code>, for example, <code class="language-plaintext highlighter-rouge">1.5-inpainting.ckpt</code>.</p>

<p>After that just select the checkpoint as you’d usually select any checkpoint and you’re good to go.</p>

<h2 id="masked-content">Masked content</h2>
<p>The masked content field determines content is placed to put into the masked regions before they are inpainted.</p>

<table>
  <thead>
    <tr>
      <th>mask</th>
      <th>fill</th>
      <th>original</th>
      <th>latent noise</th>
      <th>latent nothing</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="images/inpainting-initial-content-mask.png" alt=""></td>
      <td><img src="images/inpainting-initial-content-fill.png" alt=""></td>
      <td><img src="images/inpainting-initial-content-original.png" alt=""></td>
      <td><img src="images/inpainting-initial-content-latent-noise.png" alt=""></td>
      <td><img src="images/inpainting-initial-content-latent-nothing.png" alt=""></td>
    </tr>
  </tbody>
</table>

<h2 id="inpaint-at-full-resolution">Inpaint at full resolution</h2>
<p>Normally, inpainting resizes the image to the target resolution specified in the UI. With Inpaint at full resolution
enabled, only the masked region is resized, and after processing it is pasted back to the original picture.
This allows you to work with large pictures and allows you to render the inpainted object at a much larger resolution.</p>

<table>
  <thead>
    <tr>
      <th>Input</th>
      <th>Inpaint normal</th>
      <th>Inpaint at whole resolution</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="images/inpaint-whole-mask.png" alt=""></td>
      <td><img src="images/inpaint-whole-no.png" alt=""></td>
      <td><img src="images/inpaint-whole-yes.png" alt=""></td>
    </tr>
  </tbody>
</table>

<h2 id="masking-mode">Masking mode</h2>
<p>There are two options for masked mode:</p>
<ul>
  <li>Inpaint masked - the region under the mask is inpainted</li>
  <li>Inpaint not masked - under the mask is unchanged, everything else is inpainted</li>
</ul>

<h2 id="alpha-mask">Alpha mask</h2>

<table>
  <thead>
    <tr>
      <th>Input</th>
      <th>Output</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="images/inpaint-mask.png" alt=""></td>
      <td><img src="images/inpaint-mask2.png" alt=""></td>
    </tr>
  </tbody>
</table>

<h1 id="prompt-matrix">Prompt matrix</h1>
<p>Separate multiple prompts using the <code class="language-plaintext highlighter-rouge">|</code> character, and the system will produce an image for every combination of them.
For example, if you use <code class="language-plaintext highlighter-rouge">a busy city street in a modern city|illustration|cinematic lighting</code> prompt, there are four combinations possible (first part of the prompt is always kept):</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">a busy city street in a modern city</code></li>
  <li><code class="language-plaintext highlighter-rouge">a busy city street in a modern city, illustration</code></li>
  <li><code class="language-plaintext highlighter-rouge">a busy city street in a modern city, cinematic lighting</code></li>
  <li><code class="language-plaintext highlighter-rouge">a busy city street in a modern city, illustration, cinematic lighting</code></li>
</ul>

<p>Four images will be produced, in this order, all with the same seed and each with a corresponding prompt:
<img src="images/prompt-matrix.png" alt=""></p>

<p>Another example, this time with 5 prompts and 16 variations:
<img src="images/prompt_matrix.jpg" alt=""></p>

<p>You can find the feature at the bottom, under Script -&gt; Prompt matrix.</p>

<h1 id="color-sketch">Color Sketch</h1>

<p>Basic coloring tool for img2img. To use this feature in img2img, enable with <code class="language-plaintext highlighter-rouge">--gradio-img2img-tool color-sketch</code> in commandline args. To use this feature in inpainting mode, enable with <code class="language-plaintext highlighter-rouge">--gradio-inpaint-tool color-sketch</code>. Chromium-based browsers support a dropper tool. (see picture)</p>

<p><img src="https://user-images.githubusercontent.com/98228077/196140222-54bc71ad-2746-4c38-8075-5c53fbcde2a9.png" alt="dropper"></p>

<h1 id="stable-diffusion-upscale">Stable Diffusion upscale</h1>
<p>Upscale image using RealESRGAN/ESRGAN and then go through tiles of the result, improving them with img2img.
It also has an option to let you do the upscaling part yourself in an external program, and just go through tiles with img2img.</p>

<p>Original idea by: https://github.com/jquesnelle/txt2imghd. This is an independent implementation.</p>

<p>To use this feature, select <code class="language-plaintext highlighter-rouge">SD upscale from the scripts dropdown selection</code> (img2img tab).</p>

<p><img src="https://user-images.githubusercontent.com/39339941/193300082-be3b8864-3c28-44b7-bb75-f893f92269b6.png" alt="chrome_dl8hcMPYcx"></p>

<p>The input image will be upscaled to twice the original
width and height, and UI’s width and height sliders specify the size of individual tiles. Because of overlap,
the size of the tile can be very important: 512x512 image needs nine 512x512 tiles (because of overlap), but only
four 640x640 tiles.</p>

<p>Recommended parameters for upscaling:</p>
<ul>
  <li>Sampling method: Euler a</li>
  <li>Denoising strength: 0.2, can go up to 0.4 if you feel adventurous</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Original</th>
      <th>RealESRGAN</th>
      <th>Topaz Gigapixel</th>
      <th>SD upscale</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="images/sd-upscale-robot-original.png" alt=""></td>
      <td><img src="images/sd-upscale-robot-realesrgan.png" alt=""></td>
      <td><img src="images/sd-upscale-robot-esrgan-topaz-gigapixel.png" alt=""></td>
      <td><img src="images/sd-upscale-robot-sd-upscale.png" alt=""></td>
    </tr>
    <tr>
      <td><img src="images/sd-upscale-castle-original.png" alt=""></td>
      <td><img src="images/sd-upscale-castle-realesrgan.png" alt=""></td>
      <td><img src="images/sd-upscale-castle-esrgan-topaz-gigapixel.png" alt=""></td>
      <td><img src="images/sd-upscale-castle-sd-upscale.png" alt=""></td>
    </tr>
    <tr>
      <td><img src="images/sd-upscale-city-original.png" alt=""></td>
      <td><img src="images/sd-upscale-city-realesrgan.png" alt=""></td>
      <td><img src="images/sd-upscale-city-esrgan-topaz-gigapixel.png" alt=""></td>
      <td><img src="images/sd-upscale-city-sd-upscale.png" alt=""></td>
    </tr>
  </tbody>
</table>

<h1 id="attentionemphasis">Attention/emphasis</h1>
<p>Using <code class="language-plaintext highlighter-rouge">()</code> in the prompt increases the model’s attention to enclosed words, and <code class="language-plaintext highlighter-rouge">[]</code> decreases it. You can combine multiple modifiers:</p>

<p><img src="images/attention-3.jpg" alt=""></p>

<p>Cheat sheet:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">a (word)</code> - increase attention to <code class="language-plaintext highlighter-rouge">word</code> by a factor of 1.1</li>
  <li>
<code class="language-plaintext highlighter-rouge">a ((word))</code> - increase attention to <code class="language-plaintext highlighter-rouge">word</code> by a factor of 1.21 (= 1.1 * 1.1)</li>
  <li>
<code class="language-plaintext highlighter-rouge">a [word]</code> - decrease attention to <code class="language-plaintext highlighter-rouge">word</code> by a factor of 1.1</li>
  <li>
<code class="language-plaintext highlighter-rouge">a (word:1.5)</code> - increase attention to <code class="language-plaintext highlighter-rouge">word</code> by a factor of 1.5</li>
  <li>
<code class="language-plaintext highlighter-rouge">a (word:0.25)</code> - decrease attention to <code class="language-plaintext highlighter-rouge">word</code> by a factor of 4 (= 1 / 0.25)</li>
  <li>
<code class="language-plaintext highlighter-rouge">a \(word\)</code> - use literal <code class="language-plaintext highlighter-rouge">()</code> characters in prompt</li>
</ul>

<p>With <code class="language-plaintext highlighter-rouge">()</code>, a weight can be specified like this: <code class="language-plaintext highlighter-rouge">(text:1.4)</code>. If the weight is not specified, it is assumed to be 1.1. Specifying weight only works with <code class="language-plaintext highlighter-rouge">()</code> not with <code class="language-plaintext highlighter-rouge">[]</code>.</p>

<p>If you want to use any of the literal <code class="language-plaintext highlighter-rouge">()[]</code> characters in the prompt, use the backslash to escape them: <code class="language-plaintext highlighter-rouge">anime_\(character\)</code>.</p>

<p>On 2022-09-29, a new implementation was added that supports escape characters and numerical weights. A downside of the new implementation is that the old one was not perfect and sometimes ate characters: “a (((farm))), daytime”, for example, would become “a farm daytime” without the comma. This behavior is not shared by the new implementation which preserves all text correctly, and this means that your saved seeds may produce different pictures. For now, there is an option in settings to use the old implementation.</p>

<p>NAI uses my implementation from before 2022-09-29, except they have 1.05 as the multiplier and use <code class="language-plaintext highlighter-rouge">{}</code> instead of <code class="language-plaintext highlighter-rouge">()</code>. So the conversion applies:</p>

<ul>
  <li>their <code class="language-plaintext highlighter-rouge">{word}</code> = our <code class="language-plaintext highlighter-rouge">(word:1.05)</code>
</li>
  <li>their `` = our <code class="language-plaintext highlighter-rouge">(word:1.1025)</code>
</li>
  <li>their <code class="language-plaintext highlighter-rouge">[word]</code> = our <code class="language-plaintext highlighter-rouge">(word:0.952)</code> (0.952 = 1/1.05)</li>
  <li>their <code class="language-plaintext highlighter-rouge">[[word]]</code> = our <code class="language-plaintext highlighter-rouge">(word:0.907)</code> (0.907 = 1/1.05/1.05)</li>
</ul>

<h1 id="loopback">Loopback</h1>
<p>Selecting the loopback script in img2img allows you to automatically feed output image as input for the next batch. Equivalent to
saving output image, and replacing the input image with it. Batch count setting controls how many iterations of
this you get.</p>

<p>Usually, when doing this, you would choose one of many images for the next iteration yourself, so the usefulness
of this feature may be questionable, but I’ve managed to get some very nice outputs with it that I wasn’t able
to get otherwise.</p>

<p>Example: (cherrypicked result)</p>

<p><img src="images/loopback.jpg" alt=""></p>

<p>Original image by Anonymous user from 4chan. Thank you, Anonymous user.</p>

<h1 id="xy-plot">X/Y plot</h1>
<p>Creates a grid of images with varying parameters. Select which parameters should be shared by rows and columns using
X type and Y type fields, and input those parameters separated by comma into X values/Y values fields. For integer,
and floating point numbers, and ranges are supported. Examples:</p>

<ul>
  <li>Simple ranges:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">1-5</code> = 1, 2, 3, 4, 5</li>
    </ul>
  </li>
  <li>Ranges with increment in bracket:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">1-5 (+2)</code> = 1, 3, 5</li>
      <li>
<code class="language-plaintext highlighter-rouge">10-5 (-3)</code> = 10, 7</li>
      <li>
<code class="language-plaintext highlighter-rouge">1-3 (+0.5)</code> = 1, 1.5, 2, 2.5, 3</li>
    </ul>
  </li>
  <li>Ranges with the count in square brackets:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">1-10 [5]</code> = 1, 3, 5, 7, 10</li>
      <li>
<code class="language-plaintext highlighter-rouge">0.0-1.0 [6]</code> = 0.0, 0.2, 0.4, 0.6, 0.8, 1.0</li>
    </ul>
  </li>
</ul>

<p><img src="images/xy_grid-medusa.png" alt=""></p>

<p>Here are the settings that create the graph above:</p>

<p><img src="images/xy_grid-medusa-ui.png" alt=""></p>

<h3 id="prompt-sr">Prompt S/R</h3>
<p>Prompt S/R is one of more difficult to understand modes of operation for X/Y Plot. S/R stands for search/replace, and that’s what it does - you input a list of words or phrases, it takes the first from the list and treats it as keyword, and replaces all instances of that keyword with other entries from  the list.</p>

<p>For example, with prompt <code class="language-plaintext highlighter-rouge">a man holding an apple, 8k clean</code>, and Prompt S/R <code class="language-plaintext highlighter-rouge">an apple, a watermelon, a gun</code> you will get three prompts:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">a man holding an apple, 8k clean</code></li>
  <li><code class="language-plaintext highlighter-rouge">a man holding a watermelon, 8k clean</code></li>
  <li><code class="language-plaintext highlighter-rouge">a man holding a gun, 8k clean</code></li>
</ul>

<p>The list uses the same syntax as a line in a CSV file, so if you want to include commas into your entries you have to put text in quotes and make sure there is no space between quotes and separating commas:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">darkness, light, green, heat</code> - 4 items - <code class="language-plaintext highlighter-rouge">darkness</code>, <code class="language-plaintext highlighter-rouge">light</code>, <code class="language-plaintext highlighter-rouge">green</code>, <code class="language-plaintext highlighter-rouge">heat</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">darkness, "light, green", heat</code> - WRONG - 4 items - <code class="language-plaintext highlighter-rouge">darkness</code>, <code class="language-plaintext highlighter-rouge">"light</code>, <code class="language-plaintext highlighter-rouge">green"</code>, <code class="language-plaintext highlighter-rouge">heat</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">darkness,"light, green",heat</code> - RIGHT - 3 items - <code class="language-plaintext highlighter-rouge">darkness</code>, <code class="language-plaintext highlighter-rouge">light, green</code>, <code class="language-plaintext highlighter-rouge">heat</code>
</li>
</ul>

<h1 id="textual-inversion">Textual Inversion</h1>
<p>Short explanation: place your embeddings into the <code class="language-plaintext highlighter-rouge">embeddings</code> directory, and use the filename in the prompt.</p>

<p>Long explanation: <a href="Textual-Inversion">Textual Inversion</a></p>

<p><img src="https://user-images.githubusercontent.com/20920490/193285770-9454c5e1-e594-463c-8be8-1488ddf2877b.png" alt="grid-0037"></p>

<h1 id="resizing">Resizing</h1>
<p>There are three options for resizing input images in img2img mode:</p>

<ul>
  <li>Just resize - simply resizes the source image to the target resolution, resulting in an incorrect aspect ratio</li>
  <li>Crop and resize - resize source image preserving aspect ratio so that entirety of target resolution is occupied by it, and crop parts that stick out</li>
  <li>Resize and fill - resize source image preserving aspect ratio so that it entirely fits target resolution, and fill empty space by rows/columns from the source image</li>
</ul>

<p>Example:
<img src="images/resizing.jpg" alt=""></p>

<h1 id="sampling-method-selection">Sampling method selection</h1>
<p>Pick out of multiple sampling methods for txt2img:</p>

<p><img src="images/sampling.jpg" alt=""></p>

<h1 id="seed-resize">Seed resize</h1>
<p>This function allows you to generate images from known seeds at different resolutions. Normally, when you change resolution,
the image changes entirely, even if you keep all other parameters including seed. With seed resizing you specify the resolution
of the original image, and the model will very likely produce something looking very similar to it, even at a different resolution.
In the example below, the leftmost picture is 512x512, and others are produced with exact same parameters but with larger vertical
resolution.</p>

<table>
  <thead>
    <tr>
      <th>Info</th>
      <th>Image</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Seed resize not enabled</td>
      <td><img src="images/seed-noresize.png" alt=""></td>
    </tr>
    <tr>
      <td>Seed resized from 512x512</td>
      <td><img src="images/seed-resize.png" alt=""></td>
    </tr>
  </tbody>
</table>

<p>Ancestral samplers are a little worse at this than the rest.</p>

<p>You can find this feature by clicking the “Extra” checkbox near the seed.</p>

<h1 id="variations">Variations</h1>
<p>A Variation strength slider and Variation seed field allow you to specify how much the existing picture should be altered to look
like a different one. At maximum strength, you will get pictures with the Variation seed, at minimum - pictures with the original Seed (except
for when using ancestral samplers).</p>

<p><img src="images/seed-variations.jpg" alt=""></p>

<p>You can find this feature by clicking the “Extra” checkbox near the seed.</p>

<h1 id="styles">Styles</h1>
<p>Press the “Save prompt as style” button to write your current prompt to styles.csv, the file with a collection of styles. A dropbox to
the right of the prompt will allow you to choose any style out of previously saved, and automatically append it to your input.
To delete a style, manually delete it from styles.csv and restart the program.</p>

<p>if you use the special string <code class="language-plaintext highlighter-rouge">{prompt}</code> in your style, it will substitute anything currently in the prompt into that position, rather than appending the style to your prompt.</p>

<h1 id="negative-prompt">Negative prompt</h1>

<p>Allows you to use another prompt of things the model should avoid when generating the picture. This works by using the
negative prompt for unconditional conditioning in the sampling process instead of an empty string.</p>

<p>Advanced explanation: <a href="Negative-prompt">Negative prompt</a></p>

<table>
  <thead>
    <tr>
      <th>Original</th>
      <th>Negative: purple</th>
      <th>Negative: tentacles</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="images/negative-base.png" alt=""></td>
      <td><img src="images/negative-purple.png" alt=""></td>
      <td><img src="images/negative-tentacles.png" alt=""></td>
    </tr>
  </tbody>
</table>

<h1 id="clip-interrogator">CLIP interrogator</h1>

<p>Originally by: https://github.com/pharmapsychotic/clip-interrogator</p>

<p>CLIP interrogator allows you to retrieve the prompt from an image. The prompt won’t allow you to reproduce this
exact image (and sometimes it won’t even be close), but it can be a good start.</p>

<p><img src="images/CLIP-interrogate.png" alt=""></p>

<p>The first time you run CLIP interrogator it will download a few gigabytes of models.</p>

<p>CLIP interrogator has two parts: one is a BLIP model that creates a text description from the picture.
Other is a CLIP model that will pick few lines relevant to the picture out of a list. By default, there
is only one list - a list of artists (from <code class="language-plaintext highlighter-rouge">artists.csv</code>). You can add more lists by doing the following:</p>

<ul>
  <li>create <code class="language-plaintext highlighter-rouge">interrogate</code> directory in the same place as webui</li>
  <li>put text files in it with a relevant description on each line</li>
</ul>

<p>For example of what text files to use, see https://github.com/pharmapsychotic/clip-interrogator/tree/main/data.
In fact, you can just take files from there and use them - just skip artists.txt because you already have a list of
artists in <code class="language-plaintext highlighter-rouge">artists.csv</code> (or use that too, who’s going to stop you). Each file adds one line of text to the final description.
If you add “.top3.” to filename, for example, <code class="language-plaintext highlighter-rouge">flavors.top3.txt</code>, the three most relevant lines from this file will be
added to the prompt (other numbers also work).</p>

<p>There are settings relevant to this feature:</p>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">Interrogate: keep models in VRAM</code> - do not unload Interrogate models from memory after using them. For users with a lot of VRAM.</li>
  <li>
<code class="language-plaintext highlighter-rouge">Interrogate: use artists from artists.csv</code> - adds artist from <code class="language-plaintext highlighter-rouge">artists.csv</code> when interrogating. Can be useful to disable when you have your list of artists in <code class="language-plaintext highlighter-rouge">interrogate</code> directory</li>
  <li>
<code class="language-plaintext highlighter-rouge">Interrogate: num_beams for BLIP</code> - parameter that affects how detailed descriptions from BLIP model are (the first part of generated prompt)</li>
  <li>
<code class="language-plaintext highlighter-rouge">Interrogate: minimum description length</code> - minimum length for BLIP model’s text</li>
  <li>
<code class="language-plaintext highlighter-rouge">Interrogate: maximum descripton length</code> - maximum length for BLIP model’s text</li>
  <li>
<code class="language-plaintext highlighter-rouge">Interrogate: maximum number of lines in text file</code> - interrogator will only consider this many first lines in a file. Set to 0, the default is 1500, which is about as much as a 4GB videocard can handle.</li>
</ul>

<h1 id="prompt-editing">Prompt editing</h1>

<p><img src="https://user-images.githubusercontent.com/20920490/190426933-9748708b-6db0-4cb0-8cb9-3285053916b8.jpg" alt="xy_grid-0022-646033397"></p>

<p>Prompt editing allows you to start sampling one picture, but in the middle swap to something else. The base syntax for this is:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[from:to:when]
</code></pre></div></div>

<p>Where <code class="language-plaintext highlighter-rouge">from</code> and <code class="language-plaintext highlighter-rouge">to</code> are arbitrary texts, and <code class="language-plaintext highlighter-rouge">when</code> is a number that defines how late in the sampling cycle should the switch be made. The later it is, the less power the model has to draw the <code class="language-plaintext highlighter-rouge">to</code> text in place of <code class="language-plaintext highlighter-rouge">from</code> text. If <code class="language-plaintext highlighter-rouge">when</code> is a number between 0 and 1, it’s a fraction of the number of steps after which to make the switch. If it’s an integer greater than zero, it’s just the step after which to make the switch.</p>

<p>Nesting one prompt editing inside another does work.</p>

<p>Additionally:</p>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">[to:when]</code> - adds <code class="language-plaintext highlighter-rouge">to</code> to the prompt after a fixed number of steps (<code class="language-plaintext highlighter-rouge">when</code>)</li>
  <li>
<code class="language-plaintext highlighter-rouge">[from::when]</code> - removes <code class="language-plaintext highlighter-rouge">from</code> from the prompt after a fixed number of steps (<code class="language-plaintext highlighter-rouge">when</code>)</li>
</ul>

<p>Example:
<code class="language-plaintext highlighter-rouge">a [fantasy:cyberpunk:16] landscape</code></p>

<ul>
  <li>At start, the model will be drawing <code class="language-plaintext highlighter-rouge">a fantasy landscape</code>.</li>
  <li>After step 16, it will switch to drawing <code class="language-plaintext highlighter-rouge">a cyberpunk landscape</code>, continuing from where it stopped with fantasy.</li>
</ul>

<p>Here’s a more complex example with multiple edits:
<code class="language-plaintext highlighter-rouge">fantasy landscape with a [mountain:lake:0.25] and [an oak:a christmas tree:0.75][ in foreground::0.6][ in background:0.25] [shoddy:masterful:0.5]</code> (sampler has 100 steps)</p>

<ul>
  <li>at start, <code class="language-plaintext highlighter-rouge">fantasy landscape with a mountain and an oak in foreground shoddy</code>
</li>
  <li>after step 25, <code class="language-plaintext highlighter-rouge">fantasy landscape with a lake and an oak in foreground in background shoddy</code>
</li>
  <li>after step 50, <code class="language-plaintext highlighter-rouge">fantasy landscape with a lake and an oak in foreground in background masterful</code>
</li>
  <li>after step 60, <code class="language-plaintext highlighter-rouge">fantasy landscape with a lake and an oak in background masterful</code>
</li>
  <li>after step 75, <code class="language-plaintext highlighter-rouge">fantasy landscape with a lake and a christmas tree in background masterful</code>
</li>
</ul>

<p>The picture at the top was made with the prompt:</p>

<p>`Official portrait of a smiling world war ii general, [male:female:0.99], cheerful, happy, detailed face, 20th century, highly detailed, cinematic lighting, digital art painting by Greg Rutkowski’s</p>

<p>And the number 0.99 is replaced with whatever you see in column labels on the image.</p>

<p>The last column in the picture is [male:female:0.0], which essentially means that you are asking the model to draw a female from the start, without starting with a male general, and that is why it looks so different from others.</p>

<h2 id="alternating-words">Alternating Words</h2>

<p>Convenient Syntax for swapping every other step.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[cow|horse] in a field
</code></pre></div></div>

<p>On step 1, prompt is “cow in a field.” Step 2 is “horse in a field.” Step 3 is “cow in a field” and so on.</p>

<p><img src="https://user-images.githubusercontent.com/39339941/197556926-49ceb72b-daf3-4208-86f3-c2e7e9cd775a.gif" alt="Alternating Words"></p>

<p>See more advanced example below. On step 8, the chain loops back from “man” to “cow.”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[cow|cow|horse|man|siberian tiger|ox|man] in a field
</code></pre></div></div>

<p>Prompt editing was first implemented by Doggettx in <a href="https://www.reddit.com/r/StableDiffusion/comments/xas2os/simple_prompt2prompt_implementation_with_prompt/">this myspace.com post</a>.</p>

<h1 id="highres-fix">Highres. fix</h1>
<p>A convenience option to partially render your image at a lower resolution, upscale it, and then add details at a high resolution. By default, txt2img  makes horrible images at very high resolutions, and this makes it possible to avoid using the small picture’s composition. Enabled by checking the “Highres. fix” checkbox on the txt2img page.</p>

<table>
  <thead>
    <tr>
      <th>Without</th>
      <th>With</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="https://user-images.githubusercontent.com/20920490/191177752-ad983e62-8e1c-4197-8f3b-3165a6a6c31d.png" alt="00262-836728130"></td>
      <td><img src="https://user-images.githubusercontent.com/20920490/191177785-395a951e-0d2e-4db7-9645-4c5af9321772.png" alt="00261-836728130"></td>
    </tr>
    <tr>
      <td><img src="https://user-images.githubusercontent.com/20920490/191178018-25dcd98d-6c45-4c31-ab7a-3de6c51c52e3.png" alt="00345-950170121"></td>
      <td><img src="https://user-images.githubusercontent.com/20920490/191178048-3eba3db4-e5be-4617-9bfe-2cb36cebaafc.png" alt="00341-950170121"></td>
    </tr>
  </tbody>
</table>

<h1 id="composable-diffusion">Composable Diffusion</h1>

<p>A method to allow the combination of multiple prompts.
combine prompts using an uppercase AND</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>a cat AND a dog
</code></pre></div></div>

<p>Supports weights for prompts: <code class="language-plaintext highlighter-rouge">a cat :1.2 AND a dog AND a penguin :2.2</code>
The default weight value is 1.
It can be quite useful for combining multiple embeddings to your result: <code class="language-plaintext highlighter-rouge">creature_embedding in the woods:0.7 AND arcane_embedding:0.5 AND glitch_embedding:0.2</code></p>

<p>Using a value lower than 0.1 will barely have an effect. <code class="language-plaintext highlighter-rouge">a cat AND a dog:0.03</code> will produce basically the same output as <code class="language-plaintext highlighter-rouge">a cat</code></p>

<p>This could be handy for generating fine-tuned recursive variations, by continuing to append more prompts to your total. <code class="language-plaintext highlighter-rouge">creature_embedding on log AND frog:0.13 AND yellow eyes:0.08</code></p>

<h1 id="interrupt">Interrupt</h1>

<p>Press the Interrupt button to stop current processing.</p>

<h1 id="4gb-videocard-support">4GB videocard support</h1>
<p>Optimizations for GPUs with low VRAM. This should make it possible to generate 512x512 images on videocards with 4GB memory.</p>

<p><code class="language-plaintext highlighter-rouge">--lowvram</code> is a reimplementation of an optimization idea by <a href="https://github.com/basujindal/stable-diffusion">basujindal</a>.
Model is separated into modules, and only one module is kept in GPU memory; when another module needs to run, the previous
is removed from GPU memory. The nature of this optimization makes the processing run slower – about 10 times slower
compared to normal operation on my RTX 3090.</p>

<p><code class="language-plaintext highlighter-rouge">--medvram</code> is another optimization that should reduce VRAM usage significantly by not processing conditional and
unconditional denoising in the same batch.</p>

<p>This implementation of optimization does not require any modification to the original Stable Diffusion code.</p>

<h1 id="face-restoration">Face restoration</h1>
<p>Lets you improve faces in pictures using either GFPGAN or CodeFormer. There is a checkbox in every tab to use face restoration,
and also a separate tab that just allows you to use face restoration on any picture, with a slider that controls how visible
the effect is. You can choose between the two methods in settings.</p>

<table>
  <thead>
    <tr>
      <th>Original</th>
      <th>GFPGAN</th>
      <th>CodeFormer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="images/facefix.png" alt=""></td>
      <td><img src="images/facefix-gfpgan.png" alt=""></td>
      <td><img src="images/facefix-codeformer.png" alt=""></td>
    </tr>
  </tbody>
</table>

<h1 id="saving">Saving</h1>
<p>Click the Save button under the output section, and generated images will be saved to a directory specified in settings;
generation parameters will be appended to a csv file in the same directory.</p>

<h1 id="loading">Loading</h1>
<p>Gradio’s loading graphic has a very negative effect on the processing speed of the neural network.
My RTX 3090 makes images about 10% faster when the tab with gradio is not active. By default, the UI
now hides loading progress animation and replaces it with static “Loading…” text, which achieves
the same effect. Use the <code class="language-plaintext highlighter-rouge">--no-progressbar-hiding</code> commandline option to revert this and show loading animations.</p>

<h1 id="prompt-validation">Prompt validation</h1>
<p>Stable Diffusion has a limit for input text length. If your prompt is too long, you will get a
warning in the text output field, showing which parts of your text were truncated and ignored by the model.</p>

<h1 id="png-info">Png info</h1>
<p>Adds information about generation parameters to PNG as a text chunk. You
can view this information later using any software that supports viewing
PNG chunk info, for example: https://www.nayuki.io/page/png-file-chunk-inspector</p>

<h1 id="settings">Settings</h1>
<p>A tab with settings, allows you to use UI to edit more than half of parameters that previously
were commandline. Settings are saved to config.js file. Settings that remain as commandline
options are ones that are required at startup.</p>

<h1 id="filenames-format">Filenames format</h1>
<p>The <code class="language-plaintext highlighter-rouge">Images filename pattern</code> field in the Settings tab allows customization of generated txt2img and img2img images filenames. This pattern defines the generation parameters you want to include in filenames and their order. The supported tags are:</p>

<p><code class="language-plaintext highlighter-rouge">[steps], [cfg], [prompt], [prompt_no_styles], [prompt_spaces], [width], [height], [styles], [sampler], [seed], [model_hash], [prompt_words], [date], [datetime], [job_timestamp].</code></p>

<p>This list will evolve though, with new additions. You can get an up-to-date list of supported tags by hovering your mouse over the “Images filename pattern” label in the UI.</p>

<p>Example of a pattern: <code class="language-plaintext highlighter-rouge">[seed]-[steps]-[cfg]-[sampler]-[prompt_spaces]</code></p>

<p>Note about “prompt” tags: <code class="language-plaintext highlighter-rouge">[prompt]</code> will add underscores between the prompt words, while <code class="language-plaintext highlighter-rouge">[prompt_spaces]</code> will keep the prompt intact (easier to copy/paste into the UI again). <code class="language-plaintext highlighter-rouge">[prompt_words]</code> is a simplified and cleaned-up version of your prompt, already used to generate subdirectories names, with only the words of your prompt (no punctuation).</p>

<p>If you leave this field empty, the default pattern will be applied (<code class="language-plaintext highlighter-rouge">[seed]-[prompt_spaces]</code>).</p>

<p>Please note that the tags are actually replaced inside the pattern. It means that you can also add non-tags words to this pattern, to make filenames even more explicit. For example: <code class="language-plaintext highlighter-rouge">s=[seed],p=[prompt_spaces]</code></p>

<h1 id="user-scripts">User scripts</h1>
<p>If the program is launched with <code class="language-plaintext highlighter-rouge">--allow-code</code> option, an extra text input field for script code
is available at the bottom of the page, under Scripts -&gt; Custom code. It allows you to input python
code that will do the work with the image.</p>

<p>In code, access parameters from web UI using the <code class="language-plaintext highlighter-rouge">p</code> variable, and provide outputs for web UI
using the <code class="language-plaintext highlighter-rouge">display(images, seed, info)</code> function. All globals from the script are also accessible.</p>

<p>A simple script that would just process the image and output it normally:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">modules.processing</span>

<span class="n">processed</span> <span class="o">=</span> <span class="n">modules</span><span class="p">.</span><span class="n">processing</span><span class="p">.</span><span class="n">process_images</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Seed was: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">processed</span><span class="p">.</span><span class="n">seed</span><span class="p">))</span>

<span class="n">display</span><span class="p">(</span><span class="n">processed</span><span class="p">.</span><span class="n">images</span><span class="p">,</span> <span class="n">processed</span><span class="p">.</span><span class="n">seed</span><span class="p">,</span> <span class="n">processed</span><span class="p">.</span><span class="n">info</span><span class="p">)</span>
</code></pre></div></div>

<h1 id="ui-config">UI config</h1>
<p>You can change parameters for UI elements:</p>
<ul>
  <li>radio groups: default selection</li>
  <li>sliders: default value, min, max, step</li>
  <li>checkboxes: checked state</li>
  <li>text and number inputs: default values</li>
</ul>

<p>The file is ui-config.json in webui dir, and it is created automatically if you don’t have one when the program starts.</p>

<p>Checkboxes that would usually expand a hidden section will not initially do so when set as UI config entries.</p>

<p>Some settings will break processing, like step not divisible by 64 for width and height, and some, like changing the default
function on the img2img tab, may break UI. I do not have plans to address those in near future.</p>

<h1 id="esrgan">ESRGAN</h1>
<p>It’s possible to use ESRGAN models on the Extras tab, as well as in SD upscale.</p>

<p>To use ESRGAN models, put them into ESRGAN directory in the same location as webui.py.
A file will be loaded as a model if it has .pth extension. Grab models from the <a href="https://upscale.wiki/wiki/Model_Database">Model Database</a>.</p>

<p>Not all models from the database are supported. All 2x models are most likely not supported.</p>

<h1 id="img2img-alternative-test">img2img alternative test</h1>
<p>Deconstructs an input image using a reverse of the Euler diffuser to create the noise pattern used to construct the input prompt.</p>

<p>As an example, you can use this image. Select the img2img alternative test from the <em>scripts</em> section.</p>

<p><img src="https://user-images.githubusercontent.com/1633844/191771623-6293ec7b-c1c0-425c-9fe9-9d03313761fb.png" alt="alt_src"></p>

<p>Adjust your settings for the reconstruction process:</p>
<ul>
  <li>Use a brief description of the scene: “A smiling woman with brown hair.” Describing features you want to change helps. Set this as your starting prompt, and ‘Original Input Prompt’ in the script settings.</li>
  <li>You <em>MUST</em> use the Euler sampling method, as this script is built on it.</li>
  <li>Sampling steps: 50-60. This MUCH match the decode steps value in the script, or you’ll have a bad time. Use 50 for this demo.</li>
  <li>CFG scale: 2 or lower. For this demo, use 1.8. (Hint, you can edit ui-config.json to change “img2img/CFG Scale/step” to .1 instead of .5.</li>
  <li>Denoising strength - this <em>does</em> matter, contrary to what the old docs said. Set it to 1.</li>
  <li>Width/Height - Use the width/height of the input image.</li>
  <li>Seed…you can ignore this. The reverse Euler is generating the noise for the image now.</li>
  <li>Decode cfg scale - Somewhere lower than 1 is the sweet spot. For the demo, use 1.</li>
  <li>Decode steps - as mentioned above, this should match your sampling steps. 50 for the demo, consider increasing to 60 for more detailed images.</li>
</ul>

<p>Once all of the above are dialed in, you should be able to hit “Generate” and get back a result that is a <em>very</em> close approximation to the original.</p>

<p>After validating that the script is re-generating the source photo with a good degree of accuracy, you can try to change the details of the prompt. Larger variations of the original will likely result in an image with an entirely different composition than the source.</p>

<p>Example outputs using the above settings and prompts below (Red hair/pony not pictured)</p>

<p><img src="https://user-images.githubusercontent.com/1633844/191776138-c77bf232-1981-47c9-a4d3-ae155631f5c8.png" alt="demo"></p>

<p>“A smiling woman with blue hair.” Works.
“A frowning woman with brown hair.” Works.
“A frowning woman with red hair.” Works.
“A frowning woman with red hair riding a horse.” Seems to replace the woman entirely, and now we have a ginger pony.</p>

<h1 id="usercss">user.css</h1>
<p>Create a file named <code class="language-plaintext highlighter-rouge">user.css</code> near <code class="language-plaintext highlighter-rouge">webui.py</code> and put custom CSS code into it. For example, this makes the gallery taller:</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">#txt2img_gallery</span><span class="o">,</span> <span class="nf">#img2img_gallery</span><span class="p">{</span>
    <span class="nl">min-height</span><span class="p">:</span> <span class="m">768px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>A useful tip is you can append <code class="language-plaintext highlighter-rouge">/?__theme=dark</code> to your webui url to enable a built in <em>dark theme</em>
<br>e.g. (<code class="language-plaintext highlighter-rouge">http://127.0.0.1:7860/?__theme=dark</code>)</p>

<p>Alternatively, you can add the <code class="language-plaintext highlighter-rouge">--theme=dark</code> to the <code class="language-plaintext highlighter-rouge">set COMMANDLINE_ARGS=</code> in <code class="language-plaintext highlighter-rouge">webui-user.bat</code><br>
e.g. <code class="language-plaintext highlighter-rouge">set COMMANDLINE_ARGS=--theme=dark</code></p>

<p><img src="https://user-images.githubusercontent.com/39339941/197560013-51e535d6-7cef-4946-ab6b-747e1c76b007.png" alt="chrome_O1kvfKs1es"></p>

<h1 id="notificationmp3">notification.mp3</h1>
<p>If an audio file named <code class="language-plaintext highlighter-rouge">notification.mp3</code> is present in webui’s root folder, it will be played when the generation process completes.</p>

<p>As a source of inspiration:</p>
<ul>
  <li>https://pixabay.com/sound-effects/search/ding/?duration=0-30</li>
  <li>https://pixabay.com/sound-effects/search/notification/?duration=0-30</li>
</ul>

<h1 id="tweaks">Tweaks</h1>

<h2 id="ignore-last-layers-of-clip-model">Ignore last layers of CLIP model</h2>
<p>This is a slider in settings, and it controls how early the processing of prompt by CLIP network should be stopped.</p>

<p>A more detailed explanation:</p>

<p>CLIP is a very advanced neural network that transforms your prompt text into a numerical representation. Neural networks work very well with this numerical representation and that’s why devs of SD chose CLIP as one of 3 models involved in stable diffusion’s method of producing images. As CLIP is a neural network, it means that it has a lot of layers. Your prompt is digitized in a simple way, and then fed through layers. You get numerical representation of the prompt after the 1st layer, you feed that into the second layer, you feed the result of that into third, etc, until you get to the last layer, and that’s the output of CLIP that is used in stable diffusion. This is the slider value of 1. But you can stop early, and use the output of the next to last layer - that’s slider value of 2. The earlier you stop, the less layers of neural network have worked on the prompt.</p>

<p>Some models were trained with this kind of tweak, so setting this value helps produce better results on those models.</p>

                </section>
            </div>
<div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title">
<span class="search-results-count"></span> results matching "<span class="search-query"></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class="search-query"></span>"</h1>
    </div>
</div>
</div>
    </div>
</div>

<script>
MathJax = {
  tex: {
    inlineMath: [ ['$', '$'], ['\\(', '\\)'] ]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>

                        <a href="/sdwui-docs/extensions/" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Extensions">
                            <i class="fa fa-angle-left"></i>
                        </a>
                    

                    
                        <a href="/sdwui-docs/de/install-on-amd/" class="navigation navigation-next navigation-unique" aria-label="Next page: install on AMD">
                            <i class="fa fa-angle-right"></i>
                        </a>
                    
                </div>
            </div>

            <script>
            var gitbook = gitbook || [];
            gitbook.push(function() {
                gitbook.page.hasChanged({
    "page": {
        "title": "Introduction",
        "level": "1.1",
        "depth": 1,
        
        "next": {
            "title": "install on AMD",
            "level": "1.2",
            "depth": 1,
            "path": "_pages/en/Install-and-Run-on-AMD-GPUs.md",
            "ref": "_pages/en/Install-and-Run-on-AMD-GPUs.md",
            "articles": []
        },
        
        "dir": "ltr"
    },    "config": {
        "plugins": ["fontsettings", "highlight", "livereload", "lunr", "search", "sharing", "theme-default", "livereload"],
        "styles": {
            "ebook": "styles/ebook.css",
            "epub": "styles/epub.css",
            "mobi": "styles/mobi.css",
            "pdf": "styles/pdf.css",
            "print": "styles/print.css",
            "website": "styles/website.css"
        },
        "pluginsConfig": {
            "fontsettings": {
                "family": "sans",
                "size": 2,
                "theme": "white"
            },
            "highlight": {},
            "livereload": {},
            "lunr": {
                "ignoreSpecialCharacters": false,
                "maxIndexSize": 1000000
            },
            "search": {},            "sharing": {
                "all": ["facebook", "google", "twitter", "weibo", "instapaper", "github", "telegram"],
                "facebook": true,
                "google": false,
                "github": true,
                "github_link": "https://github.com",
                "telegram": false,
                "telegram_link": "https://t.me",
                "instapaper": false,
                "twitter": true,
                "vk": false,
                "weibo": false
            },
"theme-default": {
                "showLevel": false,
                "styles": {
                    "ebook": "styles/ebook.css",
                    "epub": "styles/epub.css",
                    "mobi": "styles/mobi.css",
                    "pdf": "styles/pdf.css",
                    "print": "styles/print.css",
                    "website": "styles/website.css"
                }
            }
        },
        "theme": "default",
        "author": "Tao He",
        "pdf": {
            "pageNumbers": true,
            "fontSize": 12,
            "fontFamily": "Arial",
            "paperSize": "a4",
            "chapterMark": "pagebreak",
            "pageBreaksBefore": "/",
            "margin": {
                "right": 62,
                "left": 62,
                "top": 56,
                "bottom": 56
            }
        },
        "structure": {
            "langs": "LANGS.md",
            "readme": "README.md",
        },
        "variables": {},
        "title": "Stable Diffusion webUI",
        "language": "en",
        "gitbook": "*"
    },
    "file": {
        "path": "_pages/en/Features.md",
        "mtime": "",
        "type": "markdown"
    },
    "gitbook": {
        "version": "3.2.3",
        "time": "2022-12-27 19:12:07 +0300"
    },
    "basePath": "/sdwui-docs",
    "book": {
        "language": ""
    }
});
            });
            </script>
        </div><script src="/sdwui-docs/assets/gitbook/gitbook.js"></script>
<script src="/sdwui-docs/assets/gitbook/theme.js"></script>

<script src="/sdwui-docs/assets/gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
<script src="/sdwui-docs/assets/gitbook/gitbook-plugin-sharing/buttons.js"></script>

<!-- <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
<script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
<script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
<script src="../gitbook/gitbook-plugin-search/search.js"></script> -->

<script src="/sdwui-docs/assets/gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
<script src="/sdwui-docs/assets/gitbook/gitbook-plugin-search-pro/search.js"></script>
<script src="/sdwui-docs/assets/gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>

</body>
</html>