<!DOCTYPE HTML>
<html lang="en" >
    <head><meta charset="UTF-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"><title>API guide · Stable Diffusion webUI</title><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="description" content="A browser interface based on Gradio library for Stable Diffusion.
"><meta name="generator" content="Jekyll (using style of GitBook 3.2.3)"><link rel="stylesheet" href="/sdwui-docs/assets/gitbook/style.css">
<link rel="stylesheet" href="/sdwui-docs/assets/gitbook/gitbook-plugin-fontsettings/website.css">
<link rel="stylesheet" href="/sdwui-docs/assets/gitbook/gitbook-plugin-search-pro/search.css">
<link rel="stylesheet" href="/sdwui-docs/assets/gitbook/gitbook-plugin-back-to-top-button/plugin.css">

<link rel="stylesheet" href="/sdwui-docs/assets/gitbook/rouge/colorful.css">

<link rel="stylesheet" href="/sdwui-docs/assets/gitbook/custom.css">

<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/sdwui-docs/assets/gitbook/images/apple-touch-icon-precomposed-152.png">
<link rel="shortcut icon" href="/sdwui-docs//assets/gitbook/images/favicon.ico" type="image/x-icon">




            <link rel="prev" href="/sdwui-docs/xformers/" />
        

        
            <link rel="next" href="/sdwui-docs/install/" />
        
    </head>
    <body>
        <div class="book">
<div class="book-summary">
    <nav role="navigation">
        <div id="lang">
<a style="font-weight: bold;" href="/sdwui-docs/api/"><img class="emoji" title=":uk:" alt=":uk:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ec-1f1e7.png" height="20" width="20"> en</a> | <a href="/sdwui-docs/ru/api/"><img class="emoji" title=":ru:" alt=":ru:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1f7-1f1fa.png" height="20" width="20"> ru</a> | <a href="/sdwui-docs/de/api/"><img class="emoji" title=":de:" alt=":de:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1e9-1f1ea.png" height="20" width="20"> de</a> | <br>
</div>
        <div id="book-search-input" role="search">
            <input type="text" placeholder="Type to search">
        </div>
        <div id="book-search-input-link" role="search">
            <a href="/sdwui-docs/assets/search.html">Click to Search</a>
        </div>
        <ul class="summary">
            
            <li class="chapter" data-level="1.1" data-path="/sdwui-docs">
            
                <!-- <a href="/sdwui-docs/">
                    Stable Diffusion webUI
                </a> -->
            </li>

            <!-- <li class="divider"></li> -->


                    
                    
                    <li>
                      <h2>Guides</h2>
                      </li>
                      
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/cli/">
                          
                              <a href="/sdwui-docs/en/cli/">
                                  Command line arguments and settings
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/custom-filenames/">
                          
                              <a href="/sdwui-docs/en/custom-filenames/">
                                  Custom images filename and subdirectory
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/custom-scripts/">
                          
                              <a href="/sdwui-docs/en/custom-scripts/">
                                  Custom scripts
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/developing-custom-scripts/">
                          
                              <a href="/sdwui-docs/en/developing-custom-scripts/">
                                  Developing custom scripts
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/extensions/">
                          
                              <a href="/sdwui-docs/en/extensions/">
                                  Extensions
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/features/">
                          
                              <a href="/sdwui-docs/en/features/">
                                  Features
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/list-of-time-zones/">
                          
                              <a href="/sdwui-docs/en/list-of-time-zones/">
                                  List of time zones
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/localization/">
                          
                              <a href="/sdwui-docs/en/localization/">
                                  Localization
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/negative-prompt/">
                          
                              <a href="/sdwui-docs/en/negative-prompt/">
                                  Negative prompt
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/optimizations/">
                          
                              <a href="/sdwui-docs/en/optimizations/">
                                  Optimizations
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/textual-inversion/">
                          
                              <a href="/sdwui-docs/en/textual-inversion/">
                                  Textual inversion
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/troubleshooting/">
                          
                              <a href="/sdwui-docs/en/troubleshooting/">
                                  Troubleshooting
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/xformers/">
                          
                              <a href="/sdwui-docs/en/xformers/">
                                  Xformers
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter active" data-level="1.2" data-path="/sdwui-docs/api/">
                          
                              <a href="/sdwui-docs/en/api/">
                                  API guide
                              </a>
                              
                                  
                                      

                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/pages/ru/Optimizations/">
                          
                              <a href="/sdwui-docs/en/pages/ru/Optimizations/">
                                  Оптимизации
                              </a>
                              
                                  
                              
                          </li>
                      
                      <li class="divider">
                    
                    </li>
<li>
                      <h2>development</h2>
                      </li>
                      
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/contributing/">
                          
                              <a href="/sdwui-docs/en/contributing/">
                                  Contributing
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/developing-extensions/">
                          
                              <a href="/sdwui-docs/en/developing-extensions/">
                                  Developing extensions
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/pages/en/Tests/">
                          
                              <a href="/sdwui-docs/en/pages/en/Tests/">
                                  Tests
                              </a>
                              
                                  
                              
                          </li>
                      
                      <li class="divider">
                    
                    </li>
<li>
                      <h2>Getting started</h2>
                      </li>
                      
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/dependencies/">
                          
                              <a href="/sdwui-docs/en/dependencies/">
                                  dependencies
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/install-on-amd/">
                          
                              <a href="/sdwui-docs/en/install-on-amd/">
                                  install on AMD
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/install-on-nvidia/">
                          
                              <a href="/sdwui-docs/en/install-on-nvidia/">
                                  install on Nvidia
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/install-on-apple/">
                          
                              <a href="/sdwui-docs/en/install-on-apple/">
                                  install on Apple
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/">
                          
                              <a href="/sdwui-docs/en/">
                                  Stable Diffusion webUI
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/install/">
                          
                              <a href="/sdwui-docs/en/install/">
                                  Install
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/online-services/">
                          
                              <a href="/sdwui-docs/en/online-services/">
                                  Online services
                              </a>
                              
                                  
                              
                          </li>
                      
                          
                          <li class="chapter" data-level="1.1" data-path="/sdwui-docs/ui-defaults/">
                          
                              <a href="/sdwui-docs/en/ui-defaults/">
                                  Changing UI defaults
                              </a>
                              
                                  
                              
                          </li>
                      
                      <li class="divider">
                    

                    

            <!-- <li>
                <a href="https://github.com/sighingnow/jekyll-gitbook/fork" target="blank" class="gitbook-link">
                    Fork it Now!
                </a>
            </li> -->
            </li>
<li><h2>Release notes</h2></li>
            
              <li>
                <a href="/sdwui-docs/2022/12/27/my-new-post/">
                  Release note example
                </a>
              </li>
            
        </ul>
    </nav>
</div>
<div class="book-body">
                <div class="book-header" role="navigation">
                    <!-- Title -->
                    <h1>
                        <i class="fa fa-circle-o-notch fa-spin"></i>
                        
                            <a href=".">API guide</a>
                        
                    </h1>
                </div>

                <div class="body-inner">
<div class="page-wrapper" tabindex="-1" role="main">
    

    <div class="page-inner">
        <div id="book-search-results">
            <div class="search-noresults">
                <section class="normal markdown-section">
                    
                        <h1 id="/api">API guide</h1>
                    

                    
                    <ul>
  <li>First, of course, is to run web ui with <code class="language-plaintext highlighter-rouge">--api</code> commandline argument
    <ul>
      <li>example in your “webui-user.bat”: <code class="language-plaintext highlighter-rouge">set COMMANDLINE_ARGS=--api</code>
</li>
    </ul>
  </li>
  <li>This enables the api which can be reviewed at http://127.0.0.1:7860/docs (or whever the URL is + /docs)
The basic ones I’m interested in are these two. Let’s just focus only on ` /sdapi/v1/txt2img`</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/2993060/198171114-ed1c5edd-76ce-4c34-ad73-04e388423162.png" alt="image"></p>

<ul>
  <li>When you expand that tab, it gives an example of a payload to send to the API. I used this often as reference.</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/2993060/198171454-5b826ded-5e73-4249-9c0c-a97b32c42569.png" alt="image"></p>

<hr>

<ul>
  <li>So that’s the backend. The API basically says what’s available, what it’s asking for, and where to send it. Now moving onto the frontend, I’ll start with constructing a payload with the parameters I want. An example can be:
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>payload = {
  "prompt": "maltese puppy",
  "steps": 5
}
</code></pre></div>    </div>
    <p>I can put in as few or as many parameters as I want in the payload. The API will use the defaults for anything I don’t set.</p>
  </li>
  <li>After that, I can send it to the API
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>response = requests.post(url=f'http://127.0.0.1:7860/sdapi/v1/txt2img', json=payload)
</code></pre></div>    </div>
    <p>Again, this URL needs to match the web ui’s URL.
If we execute this code, the web ui will generate an image based on the payload. That’s great, but then what? There is no image anywhere…</p>
  </li>
</ul>

<hr>

<ul>
  <li>After the backend does its thing, the API sends the response back in a variable that was assigned above: <code class="language-plaintext highlighter-rouge">response</code>. The response contains three entries; “images”, “parameters”, and “info”, and I have to find some way to get the information from these entries.</li>
  <li>First, I put this line <code class="language-plaintext highlighter-rouge">r = response.json()</code> to make it easier to work with the response.</li>
  <li>“images” is the generated image, which is what I want mostly. There’s no link or anything; it’s a giant string of random characters, apparently we have to decode it. This is how I do it:
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>for i in r['images']:
  image = Image.open(io.BytesIO(base64.b64decode(i.split(",",1)[0])))
</code></pre></div>    </div>
  </li>
  <li>With that, we have an image in the <code class="language-plaintext highlighter-rouge">image</code> variable that we can work with, for example saving it with <code class="language-plaintext highlighter-rouge">image.save('output.png')</code>.</li>
  <li>“parameters” shows what was sent to the API, which could be useful, but what I want in this case is “info”. I use it to insert metadata into the image, so I can drop it into web ui PNG Info. For that, I can access the <code class="language-plaintext highlighter-rouge">/sdapi/v1/png-info</code> API. I’ll need to feed the image I got above into it.
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>png_payload = {
      "image": "data:image/png;base64," + i
  }
  response2 = requests.post(url=f'http://127.0.0.1:7860/sdapi/v1/png-info', json=png_payload)
</code></pre></div>    </div>
    <p>After that, I can get the information with <code class="language-plaintext highlighter-rouge">response2.json().get("info")</code></p>
  </li>
</ul>

<hr>

<p>A sample code that should work can look like this:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import json
import requests
import io
import base64
from PIL import Image, PngImagePlugin

url = "http://127.0.0.1:7860"

payload = {
    "prompt": "puppy dog",
    "steps": 5
}

response = requests.post(url=f'{url}/sdapi/v1/txt2img', json=payload)

r = response.json()

for i in r['images']:
    image = Image.open(io.BytesIO(base64.b64decode(i.split(",",1)[0])))

    png_payload = {
        "image": "data:image/png;base64," + i
    }
    response2 = requests.post(url=f'{url}/sdapi/v1/png-info', json=png_payload)

    pnginfo = PngImagePlugin.PngInfo()
    pnginfo.add_text("parameters", response2.json().get("info"))
    image.save('output.png', pnginfo=pnginfo)
</code></pre></div></div>
<ul>
  <li>Import the things I need</li>
  <li>define the url and the payload to send</li>
  <li>send said payload to said url through the API</li>
  <li>in a loop grab “images” and decode it</li>
  <li>for each image, send it to png info API and get that info back</li>
  <li>define a plugin to add png info, then add the png info I defined into it</li>
  <li>at the end here, save the image with the png info</li>
</ul>

<hr>

<p>A note on <code class="language-plaintext highlighter-rouge">"override_settings"</code>.
The purpose of this endpoint is to override the web ui settings for a single request, such as the CLIP skip. The settings that can be passed into this parameter are visible here at the url’s /docs.</p>

<p><img src="https://user-images.githubusercontent.com/2993060/202877368-c31a6e9e-0d05-40ec-ade0-49ed2c4be22b.png" alt="image"></p>

<p>You can expand the tab and the API will provide a list. There are a few ways you can add this value to your payload, but this is how I do it. I’ll demonstrate with “filter_nsfw”, and “CLIP_stop_at_last_layers”.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>payload = {
    "prompt": "cirno",
    "steps": 20
}

override_settings = {}
override_settings["filter_nsfw"] = true
override_settings["CLIP_stop_at_last_layers"] = 2

override_payload = {
                "override_settings": override_settings
            }
payload.update(override_payload)
</code></pre></div></div>
<ul>
  <li>Have the normal payload</li>
  <li>after that, initialize a dictionary (I call it “override_settings”, but maybe not the best name)</li>
  <li>then I can add as many key:value pairs as I want to it</li>
  <li>make a new payload with just this parameter</li>
  <li>update the original payload to add this one to it</li>
</ul>

<p>So in this case, when I send the payload, I should get a “cirno” at 20 steps, with the CLIP skip at 2, as well as the NSFW filter on.</p>

<p>For certain settings or situations, you may want your changes to stay. For that you can post to the <code class="language-plaintext highlighter-rouge">/sdapi/v1/options</code> API endpoint
We can use what we learned so far and set up the code easily for this. Here is an example:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>url = "http://127.0.0.1:7860"

option_payload = {
    "sd_model_checkpoint": "Anything-V3.0-pruned.ckpt [2700c435]",
    "CLIP_stop_at_last_layers": 2
}

response = requests.post(url=f'{url}/sdapi/v1/options', json=option_payload)
</code></pre></div></div>
<p>After sending this payload to the API, the model should swap to the one I set and set the CLIP skip to 2. Reiterating, this is different from “override_settings”, because this change will persist, while “override_settings” is for a single request.
Note that if you’re changing the <code class="language-plaintext highlighter-rouge">sd_model_checkpoint</code>, the value should be the name of the checkpoint as it appears in the web ui. This can be referenced with this API endpoint (same way we reference “options” API)</p>

<p><img src="https://user-images.githubusercontent.com/2993060/202928589-114aff91-2777-4269-9492-2eab015c5bca.png" alt="image"></p>

<p>The “title” (name and hash) is what you want to use.</p>

<hr>

<p>This is as of commit <a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui/commit/47a44c7e421b98ca07e92dbf88769b04c9e28f86">47a44c7</a></p>

<p>For a more complete implementation of a frontend, my Discord bot is <a href="https://github.com/Kilvoctu/aiyabot">here</a> if anyone wants to look at it as an example. Most of the action happens in stablecog.py. There are many comments explaining what each code does.</p>

<hr>

<p>This guide can be found in <a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui/discussions/3734">discussions</a> page.</p>

<p>Also, check out this python API client library for webui: https://github.com/mix1009/sdwebuiapi</p>

                </section>
            </div>
<div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title">
<span class="search-results-count"></span> results matching "<span class="search-query"></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class="search-query"></span>"</h1>
    </div>
</div>
</div>
    </div>
</div>

<script>
MathJax = {
  tex: {
    inlineMath: [ ['$', '$'], ['\\(', '\\)'] ]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>

                        <a href="/sdwui-docs/xformers/" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Xformers">
                            <i class="fa fa-angle-left"></i>
                        </a>
                    

                    
                        <a href="/sdwui-docs/install/" class="navigation navigation-next navigation-unique" aria-label="Next page: Install">
                            <i class="fa fa-angle-right"></i>
                        </a>
                    
                </div>
            </div>

            <script>
            var gitbook = gitbook || [];
            gitbook.push(function() {
                gitbook.page.hasChanged({
    "page": {
        "title": "Introduction",
        "level": "1.1",
        "depth": 1,
        
        "next": {
            "title": "Install",
            "level": "1.2",
            "depth": 1,
            "path": "_pages/en/install.md",
            "ref": "_pages/en/install.md",
            "articles": []
        },
        
        "dir": "ltr"
    },    "config": {
        "plugins": ["fontsettings", "highlight", "livereload", "lunr", "search", "sharing", "theme-default", "livereload"],
        "styles": {
            "ebook": "styles/ebook.css",
            "epub": "styles/epub.css",
            "mobi": "styles/mobi.css",
            "pdf": "styles/pdf.css",
            "print": "styles/print.css",
            "website": "styles/website.css"
        },
        "pluginsConfig": {
            "fontsettings": {
                "family": "sans",
                "size": 2,
                "theme": "white"
            },
            "highlight": {},
            "livereload": {},
            "lunr": {
                "ignoreSpecialCharacters": false,
                "maxIndexSize": 1000000
            },
            "search": {},            "sharing": {
                "all": ["facebook", "google", "twitter", "weibo", "instapaper", "github", "telegram"],
                "facebook": true,
                "google": false,
                "github": true,
                "github_link": "https://github.com",
                "telegram": false,
                "telegram_link": "https://t.me",
                "instapaper": false,
                "twitter": true,
                "vk": false,
                "weibo": false
            },
"theme-default": {
                "showLevel": false,
                "styles": {
                    "ebook": "styles/ebook.css",
                    "epub": "styles/epub.css",
                    "mobi": "styles/mobi.css",
                    "pdf": "styles/pdf.css",
                    "print": "styles/print.css",
                    "website": "styles/website.css"
                }
            }
        },
        "theme": "default",
        "author": "Tao He",
        "pdf": {
            "pageNumbers": true,
            "fontSize": 12,
            "fontFamily": "Arial",
            "paperSize": "a4",
            "chapterMark": "pagebreak",
            "pageBreaksBefore": "/",
            "margin": {
                "right": 62,
                "left": 62,
                "top": 56,
                "bottom": 56
            }
        },
        "structure": {
            "langs": "LANGS.md",
            "readme": "README.md",
        },
        "variables": {},
        "title": "Stable Diffusion webUI",
        "language": "en",
        "gitbook": "*"
    },
    "file": {
        "path": "_pages/en/api.md",
        "mtime": "",
        "type": "markdown"
    },
    "gitbook": {
        "version": "3.2.3",
        "time": "2022-12-27 19:50:15 +0300"
    },
    "basePath": "/sdwui-docs",
    "book": {
        "language": ""
    }
});
            });
            </script>
        </div><script src="/sdwui-docs/assets/gitbook/gitbook.js"></script>
<script src="/sdwui-docs/assets/gitbook/theme.js"></script>

<script src="/sdwui-docs/assets/gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
<script src="/sdwui-docs/assets/gitbook/gitbook-plugin-sharing/buttons.js"></script>

<!-- <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
<script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
<script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
<script src="../gitbook/gitbook-plugin-search/search.js"></script> -->

<script src="/sdwui-docs/assets/gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
<script src="/sdwui-docs/assets/gitbook/gitbook-plugin-search-pro/search.js"></script>
<script src="/sdwui-docs/assets/gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>

</body>
</html>